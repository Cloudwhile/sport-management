openapi: 3.0.3
info:
  title: å­¦æ ¡ä½“æµ‹æ•°æ®ç®¡ç†ç³»ç»Ÿ API
  description: |
    å­¦æ ¡ä½“æµ‹æ•°æ®ç®¡ç†ç³»ç»Ÿçš„RESTful APIæ–‡æ¡£

    ## æ ¸å¿ƒç‰¹æ€§
    - ğŸ“ **Cohortè®¾è®¡**: ç­çº§åŸºäºå…¥å­¦å¹´ä»½ï¼ˆå¦‚"2024çº§"ï¼‰ï¼Œæ”¯æŒè‡ªåŠ¨è®¡ç®—å½“å‰å¹´çº§
    - ğŸ“Š **åŠ¨æ€å¹´çº§**: é€šè¿‡ `calculateGradeLevel(cohort, academicYear)` åŠ¨æ€è®¡ç®—ç­çº§åœ¨ç‰¹å®šå­¦å¹´çš„å¹´çº§
    - ğŸ”„ **å­¦ç”Ÿè½¬ç­**: å®Œæ•´çš„å­¦ç”Ÿ-ç­çº§å…³è”å†å²è®°å½•
    - ğŸ“ **è¡¨å•å‘å¸ƒæœºåˆ¶**: çµæ´»çš„ä½“æµ‹è¡¨å•åˆ›å»ºå’Œå‘å¸ƒæµç¨‹
    - ğŸ¯ **è‡ªåŠ¨è¯„åˆ†**: ä½“æµ‹è®°å½•æäº¤æ—¶è‡ªåŠ¨è®¡ç®—å„é¡¹åˆ†æ•°å’Œæ€»åˆ†

    ## è®¤è¯æ–¹å¼
    ä½¿ç”¨ JWT Bearer Token è¿›è¡Œè®¤è¯ã€‚ç™»å½•åè·å–tokenï¼Œåœ¨åç»­è¯·æ±‚çš„Headerä¸­æºå¸¦ï¼š
    ```
    Authorization: Bearer <token>
    ```

    ## è§’è‰²æƒé™
    - **admin**: ç®¡ç†å‘˜ï¼ˆæœ€é«˜æƒé™ï¼‰
    - **teacher**: æ•™å¸ˆï¼ˆå¯ç®¡ç†æ•™å­¦ç›¸å…³æ•°æ®ï¼‰
    - **class**: ç­çº§è´¦å·ï¼ˆå¯å½•å…¥æœ¬ç­ä½“æµ‹æ•°æ®ï¼‰

  version: 1.0.0
  contact:
    name: AptS Team
    email: support@example.com
  license:
    name: MIT

servers:
  - url: http://localhost:3000
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: http://localhost:3000/api
    description: APIåŸºç¡€è·¯å¾„

tags:
  - name: è®¤è¯
    description: ç”¨æˆ·ç™»å½•ã€ç™»å‡ºã€ä¿¡æ¯æŸ¥è¯¢
  - name: ç”¨æˆ·ç®¡ç†
    description: ç®¡ç†å‘˜å’Œæ•™å¸ˆè´¦å·ç®¡ç†ï¼ˆéœ€Adminæƒé™ï¼‰
  - name: å¹´çº§ç®¡ç†
    description: å¹´çº§ä¿¡æ¯ç®¡ç†
  - name: ç­çº§ç®¡ç†
    description: ç­çº§ç®¡ç†ï¼ˆåŸºäºCohortè®¾è®¡ï¼‰
  - name: å­¦ç”Ÿç®¡ç†
    description: å­¦ç”Ÿä¿¡æ¯å’Œè½¬ç­æ“ä½œ
  - name: è¡¨å•ç®¡ç†
    description: ä½“æµ‹è¡¨å•åˆ›å»ºã€å‘å¸ƒå’Œç®¡ç†
  - name: ä½“æµ‹è®°å½•
    description: ä½“æµ‹æ•°æ®å½•å…¥å’ŒæŸ¥è¯¢
  - name: ç»Ÿè®¡åˆ†æ
    description: å¤šç»´åº¦æ•°æ®ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
  - name: ç³»ç»Ÿ
    description: ç³»ç»Ÿå¥åº·æ£€æŸ¥ç­‰

security:
  - bearerAuth: []

paths:
  # ==================== è®¤è¯ç›¸å…³ ====================
  /api/auth/login:
    post:
      tags:
        - è®¤è¯
      summary: ç”¨æˆ·ç™»å½•
      description: æ”¯æŒç®¡ç†å‘˜ã€æ•™å¸ˆã€ç­çº§è´¦å·ç™»å½•
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: ç”¨æˆ·åæˆ–ç­çº§è´¦å·
                  example: admin
                password:
                  type: string
                  format: password
                  description: å¯†ç 
                  example: admin123
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string
                    description: JWT token
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/auth/logout:
    post:
      tags:
        - è®¤è¯
      summary: é€€å‡ºç™»å½•
      description: JWTæ— çŠ¶æ€ï¼Œä¸»è¦ç”¨äºæ¸…é™¤å‰ç«¯token
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: ç™»å‡ºæˆåŠŸ

  /api/auth/me:
    get:
      tags:
        - è®¤è¯
      summary: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
      responses:
        '200':
          description: æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== ç”¨æˆ·ç®¡ç† ====================
  /api/users:
    get:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: è·å–ç”¨æˆ·åˆ—è¡¨
      description: éœ€è¦Adminæƒé™
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 10
        - name: role
          in: query
          schema:
            type: string
            enum: [admin, teacher]
        - name: search
          in: query
          description: æœç´¢ç”¨æˆ·åæˆ–çœŸå®å§“å
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: åˆ›å»ºç”¨æˆ·
      description: éœ€è¦Adminæƒé™
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - role
              properties:
                username:
                  type: string
                password:
                  type: string
                  format: password
                role:
                  type: string
                  enum: [admin, teacher]
                realName:
                  type: string
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/User'

  /api/users/{id}:
    get:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: è·å–ç”¨æˆ·è¯¦æƒ…
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

    put:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                role:
                  type: string
                  enum: [admin, teacher]
                realName:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: åˆ é™¤ç”¨æˆ·
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/users/{id}/password:
    put:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: ä¿®æ”¹ç”¨æˆ·å¯†ç 
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: å¯†ç ä¿®æ”¹æˆåŠŸ

  /api/users/{id}/classes:
    get:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: è·å–æ•™å¸ˆç®¡ç†çš„ç­çº§åˆ—è¡¨
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Class'

    post:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: ä¸ºæ•™å¸ˆåˆ†é…ç­çº§æƒé™
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - classId
              properties:
                classId:
                  type: integer
      responses:
        '200':
          description: åˆ†é…æˆåŠŸ

  /api/users/{id}/classes/{classId}:
    delete:
      tags:
        - ç”¨æˆ·ç®¡ç†
      summary: ç§»é™¤æ•™å¸ˆçš„ç­çº§æƒé™
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: ç§»é™¤æˆåŠŸ

  # ==================== å¹´çº§ç®¡ç† ====================
  /api/grades:
    get:
      tags:
        - å¹´çº§ç®¡ç†
      summary: è·å–æ‰€æœ‰å¹´çº§
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: pageSize
          in: query
          schema:
            type: integer
        - name: sortBy
          in: query
          schema:
            type: string
        - name: order
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Grade'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - å¹´çº§ç®¡ç†
      summary: åˆ›å»ºå¹´çº§
      description: éœ€è¦Adminæˆ–Teacheræƒé™
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - gradeName
                - gradeLevel
              properties:
                gradeName:
                  type: string
                  example: ä¸€å¹´çº§
                gradeLevel:
                  type: integer
                  example: 1
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ

  /api/grades/{id}:
    get:
      tags:
        - å¹´çº§ç®¡ç†
      summary: è·å–å¹´çº§è¯¦æƒ…
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Grade'

    put:
      tags:
        - å¹´çº§ç®¡ç†
      summary: æ›´æ–°å¹´çº§
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                gradeName:
                  type: string
                gradeLevel:
                  type: integer
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags:
        - å¹´çº§ç®¡ç†
      summary: åˆ é™¤å¹´çº§
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  # ==================== ç­çº§ç®¡ç† ====================
  /api/classes:
    get:
      tags:
        - ç­çº§ç®¡ç†
      summary: è·å–æ‰€æœ‰ç­çº§
      description: |
        æ”¯æŒå¤šç§ç­›é€‰æ¡ä»¶ï¼š
        - cohort: æŒ‰å…¥å­¦å¹´ä»½ç­›é€‰ï¼ˆå¦‚"2024çº§"ï¼‰
        - gradeLevel: æŒ‰å¹´çº§ç­‰çº§ç­›é€‰ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
        - academicYear: æŒ‡å®šå­¦å¹´ç”¨äºè®¡ç®—å¹´çº§
        - graduated: æ˜¯å¦å·²æ¯•ä¸š
      parameters:
        - name: cohort
          in: query
          description: å…¥å­¦å¹´ä»½ï¼Œå¦‚"2024çº§"
          schema:
            type: string
        - name: gradeLevel
          in: query
          description: å¹´çº§ç­‰çº§ï¼ˆ1-6ï¼‰
          schema:
            type: integer
        - name: academicYear
          in: query
          description: å­¦å¹´ï¼Œå¦‚"2024-2025"
          schema:
            type: string
        - name: graduated
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/Class'
                        - type: object
                          properties:
                            currentGradeLevel:
                              type: integer
                              description: å½“å‰å¹´çº§ç­‰çº§ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
                            currentGradeName:
                              type: string
                              description: å½“å‰å¹´çº§åç§°
                            currentAcademicYear:
                              type: string
                              description: å½“å‰å­¦å¹´
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - ç­çº§ç®¡ç†
      summary: åˆ›å»ºç­çº§
      description: |
        åŸºäºCohortè®¾è®¡åˆ›å»ºç­çº§
        - cohort: å…¥å­¦å¹´ä»½ï¼Œå¦‚"2024çº§"
        - className: ç­çº§åç§°ï¼Œå¦‚"ä¸€ç­"
        - è‡ªåŠ¨ç”Ÿæˆå›ºå®šç­çº§è´¦å·: class_{å…¥å­¦å¹´ä»½}_{ç­å·}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cohort
                - className
              properties:
                cohort:
                  type: string
                  example: 2024çº§
                  description: å…¥å­¦å¹´ä»½
                className:
                  type: string
                  example: ä¸€ç­
                  description: ç­çº§åç§°
                schoolYears:
                  type: integer
                  default: 3
                  description: å­¦åˆ¶å¹´æ•°
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Class'
                  initialPassword:
                    type: string
                    description: åˆå§‹å¯†ç 
                    example: '123456'

  /api/classes/{id}:
    get:
      tags:
        - ç­çº§ç®¡ç†
      summary: è·å–ç­çº§è¯¦æƒ…
      parameters:
        - $ref: '#/components/parameters/ClassId'
        - name: academicYear
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    allOf:
                      - $ref: '#/components/schemas/Class'
                      - type: object
                        properties:
                          currentGradeLevel:
                            type: integer
                          currentGradeName:
                            type: string
                          currentAcademicYear:
                            type: string

    put:
      tags:
        - ç­çº§ç®¡ç†
      summary: æ›´æ–°ç­çº§
      parameters:
        - $ref: '#/components/parameters/ClassId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                cohort:
                  type: string
                className:
                  type: string
                graduated:
                  type: boolean
                schoolYears:
                  type: integer
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags:
        - ç­çº§ç®¡ç†
      summary: åˆ é™¤ç­çº§
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/classes/{id}/reset-password:
    post:
      tags:
        - ç­çº§ç®¡ç†
      summary: é‡ç½®ç­çº§å¯†ç 
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: é‡ç½®æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  newPassword:
                    type: string

  /api/classes/{id}/students:
    post:
      tags:
        - ç­çº§ç®¡ç†
      summary: æ·»åŠ å­¦ç”Ÿåˆ°ç­çº§
      parameters:
        - $ref: '#/components/parameters/ClassId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studentId
                - academicYear
              properties:
                studentId:
                  type: integer
                academicYear:
                  type: string
                  example: 2024-2025
      responses:
        '200':
          description: æ·»åŠ æˆåŠŸ

  /api/classes/{id}/students/{studentId}:
    delete:
      tags:
        - ç­çº§ç®¡ç†
      summary: ä»ç­çº§ç§»é™¤å­¦ç”Ÿ
      parameters:
        - $ref: '#/components/parameters/ClassId'
        - $ref: '#/components/parameters/StudentId'
      responses:
        '200':
          description: ç§»é™¤æˆåŠŸ

  # ==================== å­¦ç”Ÿç®¡ç† ====================
  /api/students:
    get:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: è·å–å­¦ç”Ÿåˆ—è¡¨
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: pageSize
          in: query
          schema:
            type: integer
        - name: search
          in: query
          description: æœç´¢å§“åæˆ–å­¦å·
          schema:
            type: string
        - name: classId
          in: query
          schema:
            type: integer
        - name: gradeId
          in: query
          schema:
            type: integer
        - name: academicYear
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Student'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: åˆ›å»ºå­¦ç”Ÿ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studentIdNational
                - studentIdSchool
                - name
                - gender
                - classId
                - academicYear
              properties:
                studentIdNational:
                  type: string
                  description: å…¨å›½ç»Ÿä¸€å­¦ç±å·
                studentIdSchool:
                  type: string
                  description: å­¦æ ¡å­¦å·
                name:
                  type: string
                gender:
                  type: string
                  enum: [male, female]
                birthDate:
                  type: string
                  format: date
                idCardNumber:
                  type: string
                phone:
                  type: string
                classId:
                  type: integer
                academicYear:
                  type: string
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ

  /api/students/{id}:
    get:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: è·å–å­¦ç”Ÿè¯¦æƒ…
      parameters:
        - $ref: '#/components/parameters/StudentId'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Student'

    put:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: æ›´æ–°å­¦ç”Ÿä¿¡æ¯
      parameters:
        - $ref: '#/components/parameters/StudentId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                studentIdNational:
                  type: string
                studentIdSchool:
                  type: string
                name:
                  type: string
                gender:
                  type: string
                  enum: [male, female]
                birthDate:
                  type: string
                  format: date
                idCardNumber:
                  type: string
                phone:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: åˆ é™¤å­¦ç”Ÿ
      parameters:
        - $ref: '#/components/parameters/StudentId'
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/students/{id}/transfer:
    post:
      tags:
        - å­¦ç”Ÿç®¡ç†
      summary: å­¦ç”Ÿè½¬ç­æ“ä½œ
      description: |
        å°†å­¦ç”Ÿè½¬åˆ°æ–°ç­çº§
        - è‡ªåŠ¨å°†åŸç­çº§å…³ç³»è®¾ä¸ºéæ¿€æ´»
        - åˆ›å»ºæ–°çš„ç­çº§å…³ç³»
        - ä¿ç•™å†å²è½¬ç­è®°å½•
      parameters:
        - $ref: '#/components/parameters/StudentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - classId
                - academicYear
              properties:
                classId:
                  type: integer
                  description: ç›®æ ‡ç­çº§ID
                academicYear:
                  type: string
                  description: è½¬ç­å­¦å¹´
      responses:
        '200':
          description: è½¬ç­æˆåŠŸ

  # ==================== è¡¨å•ç®¡ç† ====================
  /api/forms:
    get:
      tags:
        - è¡¨å•ç®¡ç†
      summary: è·å–æ‰€æœ‰è¡¨å•
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: pageSize
          in: query
          schema:
            type: integer
        - name: status
          in: query
          description: è¡¨å•çŠ¶æ€
          schema:
            type: string
            enum: [draft, published, closed]
        - name: sortBy
          in: query
          schema:
            type: string
        - name: order
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PhysicalTestForm'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - è¡¨å•ç®¡ç†
      summary: åˆ›å»ºè¡¨å•
      description: åˆ›å»ºä½“æµ‹è¡¨å•ï¼Œè‡ªåŠ¨ç”Ÿæˆé»˜è®¤å›½æ ‡æµ‹è¯•é¡¹ç›®
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - formName
                - academicYear
              properties:
                formName:
                  type: string
                  example: 2024å¹´ç§‹å­£ä½“æµ‹
                academicYear:
                  type: string
                  example: 2024-2025
                testDate:
                  type: string
                  format: date
                startTime:
                  type: string
                  format: date-time
                endTime:
                  type: string
                  format: date-time
                description:
                  type: string
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ

  /api/forms/{id}:
    get:
      tags:
        - è¡¨å•ç®¡ç†
      summary: è·å–è¡¨å•è¯¦æƒ…
      description: åŒ…å«è¡¨å•çš„æµ‹è¯•é¡¹ç›®åˆ—è¡¨
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    allOf:
                      - $ref: '#/components/schemas/PhysicalTestForm'
                      - type: object
                        properties:
                          testItems:
                            type: array
                            items:
                              $ref: '#/components/schemas/FormTestItem'

    put:
      tags:
        - è¡¨å•ç®¡ç†
      summary: æ›´æ–°è¡¨å•åŸºæœ¬ä¿¡æ¯
      description: ä»…è‰ç¨¿çŠ¶æ€å¯ç¼–è¾‘
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                formName:
                  type: string
                academicYear:
                  type: string
                testDate:
                  type: string
                  format: date
                startTime:
                  type: string
                  format: date-time
                endTime:
                  type: string
                  format: date-time
                description:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags:
        - è¡¨å•ç®¡ç†
      summary: åˆ é™¤è¡¨å•
      description: ä»…è‰ç¨¿çŠ¶æ€å¯åˆ é™¤
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/forms/{id}/publish:
    post:
      tags:
        - è¡¨å•ç®¡ç†
      summary: å‘å¸ƒè¡¨å•
      description: å°†è¡¨å•çŠ¶æ€ä» draft æ”¹ä¸º published
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: å‘å¸ƒæˆåŠŸ

  /api/forms/{id}/close:
    post:
      tags:
        - è¡¨å•ç®¡ç†
      summary: å…³é—­è¡¨å•
      description: å°†è¡¨å•çŠ¶æ€ä» published æ”¹ä¸º closed
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: å…³é—­æˆåŠŸ

  /api/forms/{id}/items:
    get:
      tags:
        - è¡¨å•ç®¡ç†
      summary: è·å–è¡¨å•çš„æµ‹è¯•é¡¹ç›®
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FormTestItem'

    put:
      tags:
        - è¡¨å•ç®¡ç†
      summary: æ›´æ–°æµ‹è¯•é¡¹ç›®é…ç½®
      description: ä»…è‰ç¨¿çŠ¶æ€å¯ç¼–è¾‘
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTestItem'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

  # ==================== ä½“æµ‹è®°å½• ====================
  /api/records/forms/{formId}/classes/{classId}/students:
    get:
      tags:
        - ä½“æµ‹è®°å½•
      summary: è·å–ç­çº§å­¦ç”Ÿåˆ—è¡¨ï¼ˆç”¨äºå½•å…¥ï¼‰
      description: è¿”å›ç­çº§æ‰€æœ‰å­¦ç”ŸåŠå…¶åœ¨æŒ‡å®šè¡¨å•ä¸‹çš„ä½“æµ‹è®°å½•
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: classId
          in: path
          required: true
          schema:
            type: integer
        - name: academicYear
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        type: object
                      class:
                        type: object
                      students:
                        type: array
                        items:
                          type: object
                          properties:
                            student:
                              $ref: '#/components/schemas/Student'
                            testItems:
                              type: array
                              items:
                                $ref: '#/components/schemas/FormTestItem'
                            record:
                              $ref: '#/components/schemas/PhysicalTestRecord'

  /api/records/forms/{formId}/students/{studentId}/record:
    get:
      tags:
        - ä½“æµ‹è®°å½•
      summary: è·å–å­¦ç”Ÿçš„ä½“æµ‹è®°å½•è¯¦æƒ…
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/PhysicalTestRecord'

    post:
      tags:
        - ä½“æµ‹è®°å½•
      summary: åˆ›å»ºæˆ–æ›´æ–°å•ä¸ªå­¦ç”Ÿçš„ä½“æµ‹è®°å½•
      description: |
        æäº¤ä½“æµ‹æ•°æ®ï¼Œç³»ç»Ÿè‡ªåŠ¨ï¼š
        - æ ¹æ®å­¦ç”Ÿæ€§åˆ«è¿‡æ»¤é€‚ç”¨çš„æµ‹è¯•é¡¹ç›®
        - è®¡ç®—å„é¡¹åˆ†æ•°
        - è®¡ç®—æ€»åˆ†å’Œç­‰çº§
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - testData
              properties:
                testData:
                  type: object
                  description: æµ‹è¯•æ•°æ®ï¼ˆé¡¹ç›®ä»£ç ä¸ºkeyï¼‰
                  example:
                    height: 165
                    weight: 55
                    lung_capacity: 3200
                    sprint_50m: 8.5
      responses:
        '200':
          description: ä¿å­˜æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/PhysicalTestRecord'

    delete:
      tags:
        - ä½“æµ‹è®°å½•
      summary: åˆ é™¤ä½“æµ‹è®°å½•
      description: éœ€è¦Adminæˆ–Teacheræƒé™
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: studentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  /api/records/forms/{formId}/records/batch:
    post:
      tags:
        - ä½“æµ‹è®°å½•
      summary: æ‰¹é‡ä¿å­˜ä½“æµ‹è®°å½•
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - records
              properties:
                records:
                  type: array
                  items:
                    type: object
                    required:
                      - studentId
                      - testData
                    properties:
                      studentId:
                        type: integer
                      testData:
                        type: object
      responses:
        '200':
          description: æ‰¹é‡ä¿å­˜æˆåŠŸ

  # ==================== ç»Ÿè®¡åˆ†æ ====================
  /api/statistics/overall:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–æ•´ä½“ç»Ÿè®¡æ•°æ®
      parameters:
        - name: academicYear
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalStudents:
                        type: integer
                      totalClasses:
                        type: integer
                      totalForms:
                        type: integer
                      totalRecords:
                        type: integer
                      yearStats:
                        type: object

  /api/statistics/forms/{formId}/classes/{classId}:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–ç­çº§ç»Ÿè®¡æ•°æ®
      description: ç»Ÿè®¡æŸè¡¨å•ä¸‹æŸç­çº§çš„ä½“æµ‹æ•°æ®ï¼ˆåŠæ ¼ç‡ã€ä¼˜ç§€ç‡ã€å¹³å‡åˆ†ç­‰ï¼‰
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: classId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      class:
                        $ref: '#/components/schemas/Class'
                      form:
                        type: object
                      stats:
                        type: object
                        properties:
                          totalStudents:
                            type: integer
                          completedStudents:
                            type: integer
                          completionRate:
                            type: string
                          avgScore:
                            type: string
                          scoreDistribution:
                            type: object
                          genderStats:
                            type: object

  /api/statistics/forms/{formId}/grades/{gradeLevel}:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–å¹´çº§ç»Ÿè®¡æ•°æ®
      description: |
        åŸºäºgradeLevelåŠ¨æ€è®¡ç®—
        - è·å–è¡¨å•å¯¹åº”å­¦å¹´çš„æ‰€æœ‰æŒ‡å®šå¹´çº§çš„ç­çº§
        - ç»Ÿè®¡å„ç­çº§æ•°æ®å’Œå¹´çº§æ•´ä½“æ•°æ®
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
        - name: gradeLevel
          in: path
          required: true
          description: å¹´çº§ç­‰çº§ï¼ˆ1-6ï¼‰
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ

  /api/statistics/forms/{formId}:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–è¡¨å•ç»Ÿè®¡æ•°æ®ï¼ˆå…¨æ ¡ï¼‰
      description: |
        å…¨æ ¡ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
        - æ•´ä½“å¹³å‡åˆ†ã€åˆ†æ•°åˆ†å¸ƒ
        - æŒ‰å¹´çº§ç»Ÿè®¡ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
        - å„é¡¹ç›®å¹³å‡æˆç»©
      parameters:
        - name: formId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ

  /api/statistics/trend:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–å†å²è¶‹åŠ¿æ•°æ®
      description: |
        æ”¯æŒå¤šç§ç­›é€‰æ–¹å¼ï¼š
        - classId: æŒ‰ç­çº§ID
        - cohort: æŒ‰å…¥å­¦å¹´ä»½
        - gradeLevel: æŒ‰å¹´çº§ç­‰çº§ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
      parameters:
        - name: classId
          in: query
          schema:
            type: integer
        - name: cohort
          in: query
          schema:
            type: string
        - name: gradeLevel
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        formId:
                          type: integer
                        formName:
                          type: string
                        academicYear:
                          type: string
                        testDate:
                          type: string
                        count:
                          type: integer
                        avgScore:
                          type: string

  /api/statistics/students/{studentId}:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–å­¦ç”Ÿå†å²ä½“æµ‹æ•°æ®
      description: æŸ¥è¯¢æŸå­¦ç”Ÿçš„æ‰€æœ‰å†å²ä½“æµ‹è®°å½•
      parameters:
        - $ref: '#/components/parameters/StudentId'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      student:
                        $ref: '#/components/schemas/Student'
                      history:
                        type: array
                        items:
                          $ref: '#/components/schemas/PhysicalTestRecord'

  /api/statistics/classes/{classId}/history:
    get:
      tags:
        - ç»Ÿè®¡åˆ†æ
      summary: è·å–ç­çº§å†å²ä½“æµ‹è¶‹åŠ¿
      description: æŸ¥è¯¢æŸç­çº§çš„å†æ¬¡ä½“æµ‹ç»Ÿè®¡æ•°æ®
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      class:
                        $ref: '#/components/schemas/Class'
                      history:
                        type: array
                        items:
                          type: object
                          properties:
                            formId:
                              type: integer
                            formName:
                              type: string
                            academicYear:
                              type: string
                            testDate:
                              type: string
                            totalCount:
                              type: integer
                            avgScore:
                              type: string
                            passRate:
                              type: string
                            excellentRate:
                              type: string

  # ==================== ç³»ç»Ÿç«¯ç‚¹ ====================
  /health:
    get:
      tags:
        - ç³»ç»Ÿ
      summary: å¥åº·æ£€æŸ¥
      security: []
      responses:
        '200':
          description: ç³»ç»Ÿæ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time

  /api:
    get:
      tags:
        - ç³»ç»Ÿ
      summary: APIä¿¡æ¯
      security: []
      responses:
        '200':
          description: APIä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  version:
                    type: string
                  description:
                    type: string

# ==================== ç»„ä»¶å®šä¹‰ ====================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer Tokenè®¤è¯

        **è·å–Token**: è°ƒç”¨ `/api/auth/login` æ¥å£è·å–token

        **ä½¿ç”¨æ–¹å¼**: åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ 
        ```
        Authorization: Bearer <your_token>
        ```

  parameters:
    UserId:
      name: id
      in: path
      required: true
      description: ç”¨æˆ·ID
      schema:
        type: integer

    ClassId:
      name: id
      in: path
      required: true
      description: ç­çº§ID
      schema:
        type: integer

    StudentId:
      name: id
      in: path
      required: true
      description: å­¦ç”ŸID
      schema:
        type: integer

  responses:
    Unauthorized:
      description: æœªæˆæƒæˆ–Tokenæ— æ•ˆ
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: string
                example: æœªæˆæƒè®¿é—®

    Forbidden:
      description: æƒé™ä¸è¶³
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: string
                example: æƒé™ä¸è¶³

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: admin
        role:
          type: string
          enum: [admin, teacher, class]
          example: admin
        realName:
          type: string
          example: ç³»ç»Ÿç®¡ç†å‘˜
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Grade:
      type: object
      properties:
        id:
          type: integer
          example: 1
        gradeName:
          type: string
          example: ä¸€å¹´çº§
        gradeLevel:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time

    Class:
      type: object
      description: |
        ç­çº§ï¼ˆåŸºäºCohortè®¾è®¡ï¼‰
        - cohort: å…¥å­¦å¹´ä»½ï¼ˆå¦‚"2024çº§"ï¼‰ï¼Œæ˜¯ç­çº§çš„æ ¸å¿ƒæ ‡è¯†
        - ç­çº§è´¦å·å›ºå®šï¼šclass_{å…¥å­¦å¹´ä»½}_{ç­å·}
        - å¹´çº§é€šè¿‡ calculateGradeLevel(cohort, academicYear) åŠ¨æ€è®¡ç®—
      properties:
        id:
          type: integer
          example: 1
        cohort:
          type: string
          example: 2024çº§
          description: å…¥å­¦å¹´ä»½
        className:
          type: string
          example: ä¸€ç­
        classAccount:
          type: string
          example: class_2024_1
          description: å›ºå®šçš„ç­çº§è´¦å·
        graduated:
          type: boolean
          example: false
          description: æ˜¯å¦å·²æ¯•ä¸š
        graduationYear:
          type: string
          example: '2026'
          description: é¢„è®¡æ¯•ä¸šå¹´ä»½
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Student:
      type: object
      properties:
        id:
          type: integer
        studentIdNational:
          type: string
          description: å…¨å›½ç»Ÿä¸€å­¦ç±å·
          example: '202400000001'
        studentIdSchool:
          type: string
          description: å­¦æ ¡å­¦å·
          example: S0001
        name:
          type: string
          example: å¼ ä¸‰
        gender:
          type: string
          enum: [male, female]
          example: male
        birthDate:
          type: string
          format: date
        idCardNumber:
          type: string
          example: '440101200801010001'
        phone:
          type: string
          example: '13800138000'
        currentClass:
          $ref: '#/components/schemas/Class'
        currentAcademicYear:
          type: string
          example: 2024-2025
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PhysicalTestForm:
      type: object
      properties:
        id:
          type: integer
        formName:
          type: string
          example: 2024å¹´ç§‹å­£ä½“æµ‹
        academicYear:
          type: string
          example: 2024-2025
        testDate:
          type: string
          format: date
        startTime:
          type: string
          format: date-time
          description: å¼€å§‹å¡«æŠ¥æ—¶é—´
        endTime:
          type: string
          format: date-time
          description: ç»“æŸå¡«æŠ¥æ—¶é—´
        status:
          type: string
          enum: [draft, published, closed]
          example: published
          description: |
            è¡¨å•çŠ¶æ€ï¼š
            - draft: è‰ç¨¿ï¼ˆå¯ç¼–è¾‘ï¼‰
            - published: å·²å‘å¸ƒï¼ˆå¯å½•å…¥æ•°æ®ï¼‰
            - closed: å·²å…³é—­ï¼ˆä¸å¯å½•å…¥ï¼‰
        description:
          type: string
        createdBy:
          type: integer
          description: åˆ›å»ºè€…ç”¨æˆ·ID
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    FormTestItem:
      type: object
      description: è¡¨å•æµ‹è¯•é¡¹ç›®
      properties:
        id:
          type: integer
        formId:
          type: integer
        itemCode:
          type: string
          example: sprint_50m
          description: é¡¹ç›®ä»£ç 
        itemName:
          type: string
          example: 50ç±³è·‘
        itemUnit:
          type: string
          example: ç§’
        genderLimit:
          type: string
          nullable: true
          enum: [null, male, female]
          description: |
            æ€§åˆ«é™åˆ¶ï¼š
            - null: é€šç”¨é¡¹ç›®ï¼ˆç”·å¥³éƒ½æµ‹ï¼‰
            - male: ä»…ç”·ç”Ÿ
            - female: ä»…å¥³ç”Ÿ
        isRequired:
          type: boolean
          example: true
        sortOrder:
          type: integer
          example: 1
        scoringStandard:
          type: object
          description: è¯„åˆ†æ ‡å‡†ï¼ˆJSONæ ¼å¼ï¼ŒåŒ…å«ç”·å¥³ä¸åŒæ ‡å‡†ï¼‰
          example:
            male:
              excellent: { min: 90, max: 100, condition: '<=7.0' }
              good: { min: 80, max: 89, condition: '<=7.5' }
              pass: { min: 60, max: 79, condition: '<=8.5' }
              fail: { min: 0, max: 59, condition: '>8.5' }
            female:
              excellent: { min: 90, max: 100, condition: '<=8.0' }
              good: { min: 80, max: 89, condition: '<=8.5' }
              pass: { min: 60, max: 79, condition: '<=9.5' }
              fail: { min: 0, max: 59, condition: '>9.5' }
        createdAt:
          type: string
          format: date-time

    PhysicalTestRecord:
      type: object
      description: ä½“æµ‹è®°å½•
      properties:
        id:
          type: integer
        formId:
          type: integer
        studentId:
          type: integer
        classId:
          type: integer
        testData:
          type: object
          description: æµ‹è¯•æ•°æ®ï¼ˆé¡¹ç›®ä»£ç ä¸ºkeyï¼Œæ•°å€¼ä¸ºvalueï¼‰
          example:
            height: 165
            weight: 55
            lung_capacity: 3200
            sprint_50m: 8.5
            standing_jump: 2.1
        scores:
          type: object
          description: å„é¡¹åˆ†æ•°ï¼ˆé¡¹ç›®ä»£ç ä¸ºkeyï¼Œåˆ†æ•°ä¸ºvalueï¼‰
          example:
            lung_capacity: 85
            sprint_50m: 90
            standing_jump: 88
        totalScore:
          type: number
          format: decimal
          example: 87.5
          description: æ€»åˆ†
        gradeLevel:
          type: string
          example: è‰¯å¥½
          description: ç­‰çº§ï¼ˆä¼˜ç§€/è‰¯å¥½/åŠæ ¼/ä¸åŠæ ¼ï¼‰
        submittedBy:
          type: string
          description: æäº¤äºº
        submittedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        total:
          type: integer
          example: 100
          description: æ€»è®°å½•æ•°
        page:
          type: integer
          example: 1
          description: å½“å‰é¡µç 
        pageSize:
          type: integer
          example: 10
          description: æ¯é¡µè®°å½•æ•°
        totalPages:
          type: integer
          example: 10
          description: æ€»é¡µæ•°
